<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REIT Investment Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .controls {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .controls button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .save-btn {
            background-color: #28a745;
            color: white;
        }
        .load-btn {
            background-color: #007bff;
            color: white;
        }
        .config-btn {
            background-color: #6c757d;
            color: white;
        }
        .controls button:hover {
            opacity: 0.9;
        }
        .status {
            margin-left: auto;
            font-size: 14px;
            color: #666;
        }
        .status.success {
            color: #28a745;
        }
        .status.error {
            color: #dc3545;
        }
        .config-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .config-modal.show {
            display: flex;
        }
        .config-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        .config-content h3 {
            margin-top: 0;
        }
        .config-content input {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .config-content .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }
        .summary-box h3 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 14px;
        }
        .summary-box .value {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #e9ecef;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .editable {
            background-color: #fff3cd;
            cursor: pointer;
        }
        .dividend-quarter {
            background-color: #d1ecf1;
        }
        .future-row {
            color: #6c757d;
            font-style: italic;
        }
        input.cell-input {
            width: 100%;
            border: none;
            padding: 4px;
            font-size: 14px;
        }
        .notes {
            max-width: 200px;
        }
        .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        @media print {
            body {
                margin: 0;
            }
            .container {
                box-shadow: none;
            }
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>REIT Investment Tracker - Road to $230k</h1>
        
        <div class="controls">
            <button class="save-btn" onclick="saveToJSONBin()">üíæ Save to Cloud</button>
            <button class="load-btn" onclick="loadFromJSONBin()">üì• Load from Cloud</button>
            <button class="config-btn" onclick="showConfig()">‚öôÔ∏è Settings</button>
            <span class="status" id="status"></span>
        </div>
        
        <div class="summary">
            <div class="summary-box">
                <h3>Current Balance</h3>
                <div class="value" id="currentBalance">$7,500.00</div>
            </div>
            <div class="summary-box">
                <h3>Remaining to Goal</h3>
                <div class="value" id="remainingGoal">$222,500.00</div>
            </div>
            <div class="summary-box">
                <h3>Progress</h3>
                <div class="value" id="progress">3.26%</div>
            </div>
            <div class="summary-box">
                <h3>Est. Monthly Dividend</h3>
                <div class="value" id="monthlyDividend">$71.88</div>
            </div>
            <div class="summary-box">
                <h3>Months to $2k/mo</h3>
                <div class="value" id="monthsToTarget">35</div>
            </div>
        </div>

        <h2>Investment Schedule</h2>
        <p><em>Yellow cells are editable. Quarterly dividend rows are highlighted in blue.</em></p>
        
        <table id="investmentTable">
            <thead>
                <tr>
                    <th>Month #</th>
                    <th>Date</th>
                    <th>Target Contribution</th>
                    <th>Actual Contribution</th>
                    <th>Dividend Received</th>
                    <th>Total Invested</th>
                    <th>Balance</th>
                    <th>Est. Monthly Dividend</th>
                    <th>Remaining to Goal</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be generated by JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Configuration Modal -->
    <div id="configModal" class="config-modal">
        <div class="config-content">
            <h3>JSONBin Configuration</h3>
            <p>To use cloud storage, you need a free JSONBin account:</p>
            <ol>
                <li>Go to <a href="https://jsonbin.io" target="_blank">jsonbin.io</a> and create an account</li>
                <li>Get your API key from the dashboard</li>
                <li>Create a new bin and copy its ID</li>
            </ol>
            
            <label for="apiKey">API Key (X-Access-Key):</label>
            <input type="password" id="apiKey" placeholder="Your JSONBin API key">
            
            <label for="binId">Bin ID:</label>
            <input type="text" id="binId" placeholder="Your JSONBin bin ID (or leave empty to create new)">
            
            <div class="button-group">
                <button onclick="hideConfig()">Cancel</button>
                <button onclick="saveConfig()" style="background-color: #28a745; color: white;">Save Configuration</button>
            </div>
        </div>
    </div>

    <script>
        let investmentData = [];
        let autoSaveTimeout;
        let config = {
            apiKey: localStorage.getItem('jsonbin_apikey') || '',
            binId: localStorage.getItem('jsonbin_binid') || ''
        };

        // Calculate running totals
        function calculateTotals() {
            let totalInvested = 0;
            let balance = 0;
            
            investmentData.forEach((row, index) => {
                if (index > 0) {
                    totalInvested += row.actual + row.dividend;
                    balance = totalInvested;
                    row.totalInvested = totalInvested;
                    row.balance = balance;
                    row.monthlyDividend = balance * 0.115 / 12;
                    row.remaining = 230000 - balance;
                } else {
                    row.totalInvested = 0;
                    row.balance = 0;
                    row.monthlyDividend = 0;
                    row.remaining = 230000;
                }
            });
        }

        // Update summary
        function updateSummary() {
            const lastActualRow = investmentData.filter(row => row.actual > 0).pop();
            const currentBalance = lastActualRow ? lastActualRow.balance : 0;
            const remaining = 230000 - currentBalance;
            const progress = (currentBalance / 230000) * 100;
            const monthlyDividend = currentBalance * 0.115 / 12;
            const monthsToTarget = remaining / 6500;
            
            document.getElementById('currentBalance').textContent = `$${currentBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('remainingGoal').textContent = `$${remaining.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('progress').textContent = `${progress.toFixed(2)}%`;
            document.getElementById('monthlyDividend').textContent = `$${monthlyDividend.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('monthsToTarget').textContent = Math.ceil(monthsToTarget);
        }

        // Render table
        function renderTable() {
            const tbody = document.querySelector('#investmentTable tbody');
            tbody.innerHTML = '';
            
            investmentData.forEach((row, index) => {
                const tr = document.createElement('tr');
                const isDividendMonth = row.month > 0 && row.month % 3 === 0;
                const isFuture = row.actual === 0 && index > 2;
                
                if (isDividendMonth) tr.classList.add('dividend-quarter');
                if (isFuture) tr.classList.add('future-row');
                
                tr.innerHTML = `
                    <td>${row.month}</td>
                    <td>${row.date}</td>
                    <td>${row.month === 0 ? '-' : `$${row.target.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}</td>
                    <td class="${index > 0 ? 'editable' : ''}" data-field="contribution" data-index="${index}">
                        ${row.month === 0 ? '-' : `$${row.actual.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}
                    </td>
                    <td class="${index > 0 ? 'editable' : ''}" data-field="dividend" data-index="${index}">
                        ${row.month === 0 ? '-' : `$${row.dividend.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`}
                    </td>
                    <td>$${row.totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${row.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${row.monthlyDividend.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>$${row.remaining.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td class="${index > 0 ? 'editable notes' : 'notes'}" data-field="notes" data-index="${index}">${row.notes}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Auto-save function
        function autoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                if (config.apiKey && config.binId) {
                    saveToJSONBin(true); // true = auto-save mode (silent)
                }
            }, 2000); // Save 2 seconds after last edit
        }

        // Handle cell editing
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('editable')) {
                const field = e.target.dataset.field;
                const index = parseInt(e.target.dataset.index);
                const currentValue = investmentData[index][field === 'contribution' ? 'actual' : field];
                
                const input = document.createElement('input');
                input.className = 'cell-input';
                input.type = field === 'notes' ? 'text' : 'number';
                input.value = field === 'notes' ? currentValue : currentValue;
                input.step = '0.01';
                
                e.target.innerHTML = '';
                e.target.appendChild(input);
                input.focus();
                input.select();
                
                input.addEventListener('blur', function() {
                    let newValue = input.value;
                    if (field !== 'notes') {
                        newValue = parseFloat(newValue) || 0;
                    }
                    
                    if (field === 'contribution') {
                        investmentData[index].actual = newValue;
                    } else {
                        investmentData[index][field] = newValue;
                    }
                    
                    calculateTotals();
                    updateSummary();
                    renderTable();
                    autoSave(); // Trigger auto-save
                });
                
                input.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        input.blur();
                    }
                });
            }
        });

        // JSONBin functions
        async function saveToJSONBin(isAutoSave = false) {
            if (!config.apiKey) {
                if (!isAutoSave) showStatus('Please configure JSONBin settings first', 'error');
                return;
            }

            try {
                const dataToSave = {
                    investmentData: investmentData,
                    lastUpdated: new Date().toISOString(),
                    version: '1.0'
                };

                let response;
                if (config.binId) {
                    // Update existing bin
                    response = await fetch(`https://api.jsonbin.io/v3/b/${config.binId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Access-Key': config.apiKey
                        },
                        body: JSON.stringify(dataToSave)
                    });
                } else {
                    // Create new bin
                    response = await fetch('https://api.jsonbin.io/v3/b', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Access-Key': config.apiKey,
                            'X-Bin-Name': 'REIT-Investment-Tracker'
                        },
                        body: JSON.stringify(dataToSave)
                    });
                }

                if (response.ok) {
                    const result = await response.json();
                    if (!config.binId && result.metadata?.id) {
                        config.binId = result.metadata.id;
                        localStorage.setItem('jsonbin_binid', config.binId);
                    }
                    if (!isAutoSave) {
                        showStatus('Saved successfully!', 'success');
                    }
                } else {
                    throw new Error('Failed to save');
                }
            } catch (error) {
                if (!isAutoSave) {
                    showStatus('Error saving: ' + error.message, 'error');
                }
            }
        }

        async function loadFromJSONBin() {
            if (!config.apiKey || !config.binId) {
                showStatus('Please configure JSONBin settings first', 'error');
                return;
            }

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${config.binId}/latest`, {
                    headers: {
                        'X-Access-Key': config.apiKey
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.record?.investmentData) {
                        investmentData = result.record.investmentData;
                        calculateTotals();
                        updateSummary();
                        renderTable();
                        showStatus('Loaded successfully!', 'success');
                    }
                } else {
                    throw new Error('Failed to load');
                }
            } catch (error) {
                showStatus('Error loading: ' + error.message, 'error');
            }
        }

        // Status display
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
            setTimeout(() => {
                status.textContent = '';
                status.className = 'status';
            }, 3000);
        }

        // Configuration modal
        function showConfig() {
            document.getElementById('apiKey').value = config.apiKey;
            document.getElementById('binId').value = config.binId;
            document.getElementById('configModal').classList.add('show');
        }

        function hideConfig() {
            document.getElementById('configModal').classList.remove('show');
        }

        function saveConfig() {
            config.apiKey = document.getElementById('apiKey').value;
            config.binId = document.getElementById('binId').value;
            
            localStorage.setItem('jsonbin_apikey', config.apiKey);
            localStorage.setItem('jsonbin_binid', config.binId);
            
            hideConfig();
            showStatus('Configuration saved!', 'success');
            
            // If we have data but no bin ID yet, save it
            if (config.apiKey && !config.binId) {
                saveToJSONBin();
            }
        }

        // Close modal when clicking outside
        document.getElementById('configModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideConfig();
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Load from JSONBin on startup
            if (config.apiKey && config.binId) {
                loadFromJSONBin();
            } else {
                // Load default data if no JSONBin configured
                loadDefaultData();
            }
        });

        function loadDefaultData() {
            const defaultData = {
                "investmentData": [
                {
                  "month": 0,
                  "date": "5/31/2025",
                  "target": 0,
                  "actual": 0,
                  "dividend": 0,
                  "notes": "Starting Point",
                  "totalInvested": 0,
                  "balance": 0,
                  "monthlyDividend": 0,
                  "remaining": 230000
                },
                {
                  "month": 1,
                  "date": "6/1/2025",
                  "target": 6500,
                  "actual": 5000,
                  "dividend": 0,
                  "notes": "Initial investment",
                  "totalInvested": 5000,
                  "balance": 5000,
                  "monthlyDividend": 47.916666666666664,
                  "remaining": 225000
                },
                {
                  "month": 2,
                  "date": "7/1/2025",
                  "target": 6500,
                  "actual": 2500,
                  "dividend": 0,
                  "notes": "July contribution",
                  "totalInvested": 7500,
                  "balance": 7500,
                  "monthlyDividend": 71.875,
                  "remaining": 222500
                },
                {
                  "month": 3,
                  "date": "8/1/2025",
                  "target": 6500,
                  "actual": 0,
                  "dividend": 0,
                  "notes": "Quarterly dividend",
                  "totalInvested": 7500,
                  "balance": 7500,
                  "monthlyDividend": 71.875,
                  "remaining": 222500
                },
                {
                  "month": 4,
                  "date": "9/1/2025",
                  "target": 6500,
                  "actual": 0,
                  "dividend": 0,
                  "notes": "",
                  "totalInvested": 7500,
                  "balance": 7500,
                  "monthlyDividend": 71.875,
                  "remaining": 222500
                },
                {
                  "month": 5,
                  "date": "10/1/2025",
                  "target": 6500,
                  "actual": 0,
                  "dividend": 0,
                  "notes": "",
                  "totalInvested": 7500,
                  "balance": 7500,
                  "monthlyDividend": 71.875,
                  "remaining": 222500
                },
                {
                  "month": 6,
                  "date": "11/1/2025",
                  "target": 6500,
                  "actual": 0,
                  "dividend": 0,
                  "notes": "Quarterly dividend",
                  "totalInvested": 7500,
                  "balance": 7500,
                  "monthlyDividend": 71.875,
                  "remaining": 222500
                }
              ]
            };
            
            investmentData = defaultData.investmentData;
            calculateTotals();
            updateSummary();
            renderTable();
        }
    </script>
</body>
</html>
